---
title: Buffon's Needle
category: 
indexing: true
comments: true
excerpt: Modelling the probability of a needle intersecting a line when randomly dropped. Uses analytical and graphical approaches to find the probability of a needle intersecting a line on the floor. 
author: Arthur York
---

Buffon's Needle is a probability problem originially discussed in the 18th century. The problem revolves around needles of a given length, and a floor that has parallel lines equidistant from each other continuing forever. The goal is to determine the probability that a needle randomly thrown anywhere on the floor intersects one of those lines based upon its length and the distance between the lines. In this post, I derive the analytical solution of this probability and conduct a Monte Carlo simulation of the Buffon's needle problem in Julia.

I did this work under two assumptions. The first is that the length of the needle must be less than the distance between the lines. This simplified the problem because it eliminates the chance that the needle intersects two or more lines. The second assumption is that there is no preference for the way a needle falls. The needles will be uniformly distributed across their "state space".


{:.centerr}
<figure>
    <img src="/images/Buffon/buffon_floor.png" alt="image" style="width: 70%;">
    <figcaption>Fig 1. An example of Buffon's Needle, where the vertical strips are the parallel lines on the floor, and the arrows represent the needles</figcaption>
</figure>

## Representing the Needle and the Floor

The position and orientation of a needle thrown onto the floor can be described by the Cartesian coordinates &(x,y)$ of its center and the angle $\theta$ it makes with veritcal. The floor can be described by the distance $D$ between successive parallel lines repeating ad infitum in the $x$-direction.

#### Irrelevance of $y$ position of the needle for determining intersection

Given two needles with identical $x$ coordinates and angle $\theta$, we notice that their $y$ coordinates do not have an impact on whether they intersect a line or not. Therefore we do not need to consider it for our calculations, and only need to keep track of the $x$-coordinate and angle $\theta$ of a needle during the simulation.

#### Periodic Boundary Conditions in the $x$ Direction

The successive lines on the floor are $D$ distance apart and repeat infinitely in the $x%-direction. The simulation needs to model a needle being dropped anywhere on this infinite floor, and it is impractical to create an infinite floor for the simulation. If we define two lines and the space between them as a chunk, we can see that the fraction of needles that intersect a line in each chunk is expected to be the same. Thus for our simulation, we can consider only a single chunk $0 \leq x \leq D$ and arrive at the answer to Buffon's needle problem.

#### Periodic Boundary Conditions for $\angle\theta$

It would make sense to allow the angle with vertical $0 \leq \theta \leq 2\pi$, however we can take advantage of some rotational symmetry. A needle with angle $\theta$ appears equivalently to a needle with the same coordinates and angle of $\theta + \pi$. We therefore only allow $0 \leq \theta \leq \pi$. for example, since $0 \leq \theta \leq \pi$ contains $\frac{\pi}{4}$ there is no need to test $\frac{5\pi}{4}$ because they would describe the same orientation of a needle.

#### The State Space of a Needle

{:.center}
<figure>
    <img src="/images/Buffon/buffon_needle.png" alt="image" style="width: 70%;">
    <figcaption>Fig 2. A needle with its state labelled</figcaption>
</figure>

The "state space" $R$ of a needle, and therefore the simulation box for our simulation is:

$$R = \left \{ (x,\theta) \mid 0\leq x\leq D,0\leq \theta \leq \pi \right \}$$

Randomly throwing a needle on the floor in our simulation is equivalent to drawing a uniformly distributed sample from the state space $R$.

I created a Needle struct in order to conveniently store all the relevant attributes of a needle in one data structure in Julia.

{% highlight julia %}
struct Needle
    x::Number
    length::Number
    θ::Number
end
{% endhighlight %}

For the floor, i describe it by a single value D::Number.

For the simulation, I created a throw\_needle function that generates a needle uniformly distributed in the state space given by a given length of needle $\ell$ and distance $D$ between the lines:

{% highlight julia %}
function throw_needle(length::Number,distance::Number)
    return Needle(rand()*distance,length,rand()*π)
end
{% endhighlight %}

This function essentially "samples" the needle state space.

## Testing for Intersection

A needle will intersect a line if part of the needle overlaps $x=0$ or $x=D$. We check for overlap by checking the $x$-coordintes of the endpoints of the needles. If one of those are outside the simulation box (one is less than 0 or greater than $D$), then the needle intersects a line. 

The $x$-coordinates of the two endpoints of a needle are found as follows. First, take the $x$-coordinate for the center of the needle. Then add or subtract half of the length of the projection of the needle onto the $x$-axis, $\frac{\ell}{s}\sin\theta$. This generates two conditions for whether or not a needle crosses a line. This is where the assumption that $l < D$ is important. It restricts all needles to only intersect the $x=0$ or $x=D$ lines (or none) in the simulation box. A needle with coordinate $x$ and angle $\theta$ intersects a line if and only if:

<center>$x+\frac{\ell}{2}sin\theta\geq D$ or $x-\frac{\ell}{2}sin\theta\leq 0$</center>

The following function in Julia checks if a Needle intersects a line on the floor:

{% highlight Julia %}
function check_intersection(needle::Needle, D::Number)
	if needle.x + needle.length / 2 * sin(needle.θ) >= D
		return true
	elseif needle.x - needle.length / 2 * sin(needle.θ) <= 0
		return true
	else
		return false
	end
end
{% endhighlight %}

## Calculating Probability Analytically

To analytically obtain the probability of a needle intersecting a line, we can look at the fraction of the state sapce that leads to a needle intersecting a line. Visually, we can graph the state space $R$ of the needle in the $(x,\theta)$ plane and shade the regions of state sapce that result in needles intersecting lines. These regions are described by $x+\frac{\ell}{2}\sin\theta>D$ and $x-\frac{\ell}{2}\sin\theta<0$. The total areas of these regions divided by the total area of the state space is then the probability of a needle intersecting a line.

The area of the total state space of the needle is:

<center>$$A_w=\int_{0}^{\pi}(D)d\theta dx=D\pi$$</center>

The area of the function $x-\frac{l}{2}sin\theta\leq0$ is:

<center>$$A_1=\int_{0}^{\pi}(\frac{l}{2}sin\theta)d\theta=l$$</center>

The area of the function $x+\frac{l}{2}sin\theta\geq D$ is:

<center>$$A_2=\int_{0}^{\pi}(D)d\theta-\int_{0}^{\pi}(D-\frac{l}{2}sin\theta)d\theta=\int_{0}^{\pi}(\frac{l}{2}sin\theta)d\theta=l$$</center>

Therefore, the total area of needle state space that results in intersection with a line on the floor is:

<center>$A_1+A_2=l+l=2l$</center>

And we can calculate the probability of a needle landing on a needle with:

<center>$P=\frac{A_1+A_2}{A_w}=\frac{2l}{D\pi}$</center>

## Calculating the Probability Through a Monte Carlo Simulation

To calculate the probability with a Monte Carlo simulation we will "throw" needles at random, giving them uniformly random $x$ positions and uniformly random angles $\theta$. This is effectively sampling a point from the needle state space $R$. If the needles are evenly distributed in the simulation, then the percentage of needles that intersects a line is simply the number of needles that intersected a line divided by the total number of needles thrown.

The part that generates the probability takes the array of needles and makes a new array, overlaps, that stores True if the given needle intersects, and False if it doesn't. It then uses the count method to get the total number of overlaps, stored in sum\_hits. In my code I used a num\_throws variable to call whenever the number of needles is needed, so when I calculate the probability I can simply divide sum\_hits by num\_throws

{% highlight julia %}
function simulate_buffons_needles(nb_throws::Number, needle_length::Number, D::Number)
	nb_overlaps = 0
	for t = 1:nb_throws
		needle = throw_needle(needle_length, D)
		if check_intersection(needle, D)
			nb_overlaps += 1
		end
	end
	return nb_overlaps / nb_throws #estimate for probability of intersection
end
{% endhighlight %}

I created a state\_space function that would plot out randomly generated needles in their state space, with blue dots representing needles that intersected a line, and red dots representing ones that didn't. This was valuable because once the data was graphed, the curves $x+\frac{l}{2}sin\theta\geq d$ and $x-\frac{l}{2}sin\theta\leq 0$ from the analytical approach were noticeable.

{:.center}
<figure>
    <img src="/images/Buffon/statespace.png" alt="image" style="width: 70%;">
    <figcaption>Fig 3. A statespace graph of the needle, with blue showing needles that intersect the line</figcaption>
</figure>

When I ran the simulations, I would compare the theoretical probability $\frac{2l}{d\pi}$ with the probability calculated from the simulation. I chose the 10 for the length of the needle and 30 as the distance between the lines as arbitrary values. Using these numbers in the analytical solution, I expect a probability around 21.22% of a needle hitting a line, and the statespace graph above gave a simulated probability of about 20.00%.

To check the accuracy of these results, I made another plot that showed the average value of a given number of throws. This also had error bars describing the range of probabilities it got based on the standard deviation

{:.center}
<figure>
    <img src="/images/Buffon/error_bar.png" alt="image" style="width: 70%;">
    <figcaption>Fig 4. This shows that as the number of throws increases, the error decreases and the experimental value approaches the analytical value</figcaption>
</figure>

The simulation that generated the statespace graph was generated using 2500 needle throws. The simulated probability was about 20.00%, to check this value, we can compare it to the error bar for $10^{3}$ throws because they have the same magnitude. The lower error bar for $10^{3}$ is around 20.00%, so we see that our statespace graph is accurate when we use 2500 needle throws. 
